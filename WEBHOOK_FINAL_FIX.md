# –û–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Webhook –ø—Ä–æ–±–ª–µ–º—ã

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã
–ó–∞–ø—É—Å—Ç–∏–ª–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç `debug_webhook.py` –∏ –æ–±–Ω–∞—Ä—É–∂–∏–ª–∏:

```
üìç Current webhook URL: https://nutrition-bot.railway.app/webhook
üìä Pending updates: 6
‚ùå Last error message: Wrong response from the webhook: 404 Not Found
```

## üéØ –ö–æ—Ä–µ–Ω—å –ø—Ä–æ–±–ª–µ–º—ã
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ webhook handler –≤ `main.py`

**–ß—Ç–æ –±—ã–ª–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
1. –°–Ω–∞—á–∞–ª–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª—Å—è webhook –≤ Telegram
2. –ó–∞—Ç–µ–º —Å–æ–∑–¥–∞–≤–∞–ª—Å—è SimpleRequestHandler
3. Handler —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª—Å—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ **–ü–û–°–õ–ï** –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
4. –†–µ–∑—É–ª—å—Ç–∞—Ç: 404 Not Found –Ω–∞ `/webhook` endpoint

## ‚úÖ –†–µ—à–µ–Ω–∏–µ
**–§–∞–π–ª:** `main.py` - –º–µ—Ç–æ–¥ `start_webhook()`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```python
# –ë–´–õ–û (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
await self.bot.set_webhook(...)  # –°–Ω–∞—á–∞–ª–∞ webhook
webhook_requests_handler = SimpleRequestHandler(...)
webhook_requests_handler.register(self.app, path=webhook_path)  # –ü–æ—Ç–æ–º handler
# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

# –°–¢–ê–õ–û (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
webhook_requests_handler = SimpleRequestHandler(...)
webhook_requests_handler.register(self.app, path=webhook_path)  # –°–Ω–∞—á–∞–ª–∞ handler
# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
await self.bot.set_webhook(...)  # –ü–æ—Ç–æ–º webhook
```

## üìã –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
1. ‚úÖ –î–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞–ª–∏ –ø—Ä–æ–±–ª–µ–º—É —á–µ—Ä–µ–∑ `debug_webhook.py`
2. ‚úÖ –ù–∞—à–ª–∏ –ø—Ä–∏—á–∏–Ω—É: 404 Not Found –Ω–∞ webhook endpoint
3. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏–ª–∏ –ø–æ—Ä—è–¥–æ–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ handler –≤ `main.py`
4. ‚úÖ –î–æ–±–∞–≤–∏–ª–∏ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
5. ‚úÖ –ö–æ–º–º–∏—Ç–∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è: `a728a7a`
6. ‚úÖ –û—Ç–ø—Ä–∞–≤–∏–ª–∏ –≤ GitHub –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è

## üöÄ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
–ü–æ—Å–ª–µ –ø–µ—Ä–µ—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è Railway (2-3 –º–∏–Ω—É—Ç—ã):
1. Webhook handler –±—É–¥–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –¥–æ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
2. Endpoint `/webhook` –±—É–¥–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. Telegram —Å–º–æ–∂–µ—Ç –¥–æ—Å—Ç–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –±–æ—Ç—É
4. –ë–æ—Ç –Ω–∞—á–Ω–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –∫–æ–º–∞–Ω–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –º–æ–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:
1. –û—Ç–ø—Ä–∞–≤–∏—Ç—å `/start` –∫–æ–º–∞–Ω–¥—É –±–æ—Ç—É –≤ Telegram
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å `debug_webhook.py` –µ—â–µ —Ä–∞–∑ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Railway –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

## üìä –ö–æ–º–º–∏—Ç—ã
- **a728a7a**: "Fix webhook handler registration order - register handler before starting server"
- **aa3c082**: "Fix webhook URL to use RAILWAY_PUBLIC_DOMAIN instead of internal domain"
- **b2203c4**: "Fix webhook URL configuration to use RAILWAY_PRIVATE_DOMAIN"

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- **–ü—Ä–æ–±–ª–µ–º–∞**: –õ–æ–≥–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ –ø–æ—Ä—è–¥–∫–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- **–†–µ—à–µ–Ω–∏–µ**: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ handler
- **–§–∞–π–ª—ã**: `main.py` (12 insertions, 10 deletions)
- **–°—Ç–∞—Ç—É—Å**: –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
