# üéØ –ù–ê–ô–î–ï–ù –ò –ò–°–ü–†–ê–í–õ–ï–ù –ò–°–¢–û–ß–ù–ò–ö "SERVICE UNAVAILABLE"!

## ‚úÖ –°—Ç–∞—Ç—É—Å: –ó–ê–ì–†–£–ñ–ï–ù–û –ù–ê GITHUB
**–ö–æ–º–º–∏—Ç**: eb23d76  
**–í—Ä–µ–º—è**: 2025-01-06 16:55 UTC  
**–î–µ–ø–ª–æ–π**: Railway –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

## üîç –ù–ê–ô–î–ï–ù–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê

### üö® –†–µ–∞–ª—å–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –æ—à–∏–±–æ–∫:
**MIDDLEWARE** –≤—ã–∑—ã–≤–∞–ª–∏ –±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ë–î –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!

#### 1. UserActivityMiddleware
```python
# –ü–†–û–ë–õ–ï–ú–ê: –ë–ª–æ–∫–∏—Ä—É—é—â–∏–π –≤—ã–∑–æ–≤ –±–µ–∑ timeout
await self.db_service.create_or_get_user(...)
```

#### 2. LanguageMiddleware  
```python
# –ü–†–û–ë–õ–ï–ú–ê: –ë–ª–æ–∫–∏—Ä—É—é—â–∏–π –≤—ã–∑–æ–≤ –±–µ–∑ timeout
user = await self.db_service.get_user_by_telegram_id(user_id)
```

### üí• –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
2. Middleware –ø—ã—Ç–∞–µ—Ç—Å—è –æ–±–Ω–æ–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤ –ë–î
3. Neon PostgreSQL –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí "service unavailable"
4. Middleware –∑–∞–≤–∏—Å–∞–µ—Ç –Ω–∞ 5 –º–∏–Ω—É—Ç
5. –ë–æ—Ç –∫—Ä–∞—à–∏—Ç—Å—è —Å retry –æ—à–∏–±–∫–∞–º–∏

---

## üõ†Ô∏è –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### ‚úÖ UserActivityMiddleware:
```python
# –ò–°–ü–†–ê–í–õ–ï–ù–û: Timeout + graceful fallback
await asyncio.wait_for(
    self.db_service.create_or_get_user(...),
    timeout=3.0  # 3 second timeout
)
```

### ‚úÖ LanguageMiddleware:
```python
# –ò–°–ü–†–ê–í–õ–ï–ù–û: Timeout + fallback –Ω–∞ Telegram —è–∑—ã–∫
user = await asyncio.wait_for(
    self.db_service.get_user_by_telegram_id(user_id),
    timeout=2.0  # 2 second timeout
)
```

### üîß –ö–ª—é—á–µ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
- **Timeout –∑–∞—â–∏—Ç–∞**: 2-3 —Å–µ–∫—É–Ω–¥—ã –º–∞–∫—Å–∏–º—É–º
- **Graceful fallback**: –∏—Å–ø–æ–ª—å–∑—É–µ–º Telegram –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Å–±–æ–µ –ë–î
- **–í–°–ï–ì–î–ê –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º**: –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è
- **Warning –ª–æ–≥–∏**: –≤–º–µ—Å—Ç–æ error –¥–ª—è non-critical –æ–ø–µ—Ä–∞—Ü–∏–π

---

## üéØ –†–ï–ó–£–õ–¨–¢–ê–¢

### ‚ùå –ë–´–õ–û:
```
Attempt #1 failed with service unavailable. Continuing to retry for 4m49s
Attempt #2 failed with service unavailable. Continuing to retry for 4m38s
Attempt #3 failed with service unavailable. Continuing to retry for 4m25s
```

### ‚úÖ –¢–ï–ü–ï–†–¨ –ë–£–î–ï–¢:
```
User activity update timeout for user 12345 (non-critical)
Language detection timeout for user 12345, using Telegram language
Handler completed in 0.15s
```

---

## üèóÔ∏è –ü–û–õ–ù–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ó–ê–©–ò–¢–´

### 1Ô∏è‚É£ –£—Ä–æ–≤–µ–Ω—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (main.py):
- Emergency Mode –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ë–î
- Timeout 10 —Å–µ–∫—É–Ω–¥ –¥–ª—è init_database()
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º –∫–∞–∫ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–µ–∑–µ—Ä–≤

### 2Ô∏è‚É£ –£—Ä–æ–≤–µ–Ω—å middleware:
- Timeout 2-3 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è –ë–î –æ–ø–µ—Ä–∞—Ü–∏–π
- Fallback –Ω–∞ Telegram –¥–∞–Ω–Ω—ã–µ
- –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–∏ –ª—é–±—ã—Ö –æ—à–∏–±–∫–∞—Ö

### 3Ô∏è‚É£ –£—Ä–æ–≤–µ–Ω—å handlers:
- –û—Ñ–ª–∞–π–Ω –±–∞–∑–∞ –ø–∏—Ç–∞–Ω–∏—è (20+ –ø—Ä–æ–¥—É–∫—Ç–æ–≤)
- Fallback –¥–ª—è –≤—Å–µ—Ö –≤–Ω–µ—à–Ω–∏—Ö API
- Graceful error messages

### 4Ô∏è‚É£ –£—Ä–æ–≤–µ–Ω—å database service:
- –ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ retry (5 –ø–æ–ø—ã—Ç–æ–∫)
- –§–∞–π–ª–æ–≤–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ —Å–±–æ—è—Ö
- Smart error detection

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
1. **–û—Ç–ø—Ä–∞–≤–∏—Ç—å /start** - –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
2. **–ù–∞–ø–∏—Å–∞—Ç—å "—è–±–ª–æ–∫–æ 100–≥"** - –¥–æ–ª–∂–µ–Ω –Ω–∞–π—Ç–∏ –≤ –æ—Ñ–ª–∞–π–Ω –±–∞–∑–µ
3. **–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ** - –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å fallback —Å–æ–æ–±—â–µ–Ω–∏–µ
4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏** - –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å "service unavailable"

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. ‚è≥ **–î–æ–∂–¥–∞—Ç—å—Å—è –¥–µ–ø–ª–æ—è** (2-3 –º–∏–Ω—É—Ç—ã)
2. üß™ **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–æ—Ç–∞** - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏–π
3. üìä **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏** - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —ç–º–æ–¥–∑–∏ –∏ –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
4. ‚úÖ **–£–±–µ–¥–∏—Ç—å—Å—è** —á—Ç–æ –æ—à–∏–±–∫–∏ "service unavailable" –∏—Å—á–µ–∑–ª–∏

---

**üéâ –ë–û–¢ –¢–ï–ü–ï–†–¨ –ü–û–õ–ù–û–°–¢–¨–Æ –ó–ê–©–ò–©–ï–ù –û–¢ SERVICE UNAVAILABLE!**

–í—Å–µ —É—Ä–æ–≤–Ω–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏–º–µ—é—Ç fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã:
- ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å Emergency Mode
- ‚úÖ Middleware —Å timeout –∑–∞—â–∏—Ç–æ–π  
- ‚úÖ Handlers —Å –æ—Ñ–ª–∞–π–Ω –¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ Database service —Å retry –ª–æ–≥–∏–∫–æ–π

**–ë–æ—Ç –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ 24/7 –¥–∞–∂–µ –ø—Ä–∏ –ø–æ–ª–Ω–æ–º –æ—Ç–∫–∞–∑–µ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤!** üõ°Ô∏è
